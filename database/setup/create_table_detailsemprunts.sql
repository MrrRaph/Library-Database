CREATE TABLE DETAILSEMPRUNTS 
(
  EMPRUNT NUMBER(10) NOT NULL 
, NUMERO NUMBER(3) NOT NULL 
, ISBN NUMBER(10) NOT NULL 
, EXEMPLAIRE NUMBER(5) 
, RENDULE DATE 
, CONSTRAINT DETAILSEMPRUNTS_PK PRIMARY KEY 
  (
    EMPRUNT 
  , NUMERO 
  , ISBN 
  )
  ENABLE 
);

ALTER TABLE DETAILSEMPRUNTS
ADD CONSTRAINT DETAILSEMPRUNTS_FK1 FOREIGN KEY
(
  EMPRUNT 
)
REFERENCES EMPRUNTS
(
  NUMERO 
)
ENABLE;

ALTER TABLE DETAILSEMPRUNTS
ADD CONSTRAINT DETAILSEMPRUNTS_FK2 FOREIGN KEY
(
  ISBN 
)
REFERENCES OUVRAGES
(
  ISBN 
)
ENABLE;

ALTER TABLE DETAILSEMPRUNTS
ADD CONSTRAINT DETAILSEMPRUNTS_FK3 FOREIGN KEY
(
  ISBN 
, EXEMPLAIRE 
)
REFERENCES EXEMPLAIRES
(
  ISBN 
, NUMERO 
)
ENABLE;

ALTER TABLE DETAILSEMPRUNTS 
DROP CONSTRAINT DETAILSEMPRUNTS_FK2;

ALTER TABLE DETAILSEMPRUNTS 
DROP CONSTRAINT DETAILSEMPRUNTS_FK1;

ALTER TABLE DETAILSEMPRUNTS 
DROP CONSTRAINT DETAILSEMPRUNTS_FK3;

ALTER TABLE DETAILSEMPRUNTS
ADD CONSTRAINT FK_DETAILS_EMPRUNTS FOREIGN KEY
(
  EMPRUNT 
)
REFERENCES EMPRUNTS
(
  NUMERO 
)
ON DELETE CASCADE ENABLE;

Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('1','1','2038704015','1',to_date('06/09/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('1','2','2070367177','2',to_date('11/09/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('2','1','2080720872','1',to_date('21/09/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('2','2','2203314168','1',to_date('22/09/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('3','1','2038704015','1',to_date('01/10/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('4','1','2203314168','2',to_date('16/10/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('4','2','2080720872','1',to_date('16/10/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('4','3','2266085816','1',to_date('12/10/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('5','1','2038704015','1',to_date('31/10/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('6','1','2266085816','2',to_date('30/10/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('6','2','2080720872','2',to_date('10/11/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('6','3','2746021285','1',to_date('07/11/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('7','1','2070367177','2',to_date('10/12/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('8','1','2080720872','1',to_date('24/11/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('9','1','2038704015','1',to_date('10/12/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('10','1','2080720872','2',to_date('03/12/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('10','2','2746026090','1',to_date('01/01/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('11','1','2746021285','1',to_date('29/12/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('12','1','2203314168','1',to_date('24/12/16','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('12','2','2038704015','1',to_date('19/01/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('13','1','2070367177','1',to_date('14/01/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('14','1','2266091611','1',to_date('13/01/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('15','1','2070400816','1',to_date('29/01/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('16','1','2253010219','2',to_date('07/02/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('16','2','2070367177','2',to_date('07/02/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('17','1','2877065073','2',to_date('12/02/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('18','1','2070367177','1',to_date('06/03/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('19','1','2746026090','1',to_date('08/03/17','DD/MM/RR'));
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('20','1','2266091611','1',null);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values ('20','2','2253010219','1',null);

Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (7,2,2038704015,1,sysdate-136);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (8,2,2038704015,1,sysdate-127);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (11,2,2038704015,1,sysdate-95);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (15,2,2038704015,1,sysdate-54);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (16,3,2038704015,1,sysdate-43);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (17,2,2038704015,1,sysdate-36);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (18,2,2038704015,1,sysdate-24);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (19,2,2038704015,1,sysdate-13);
Insert into DETAILSEMPRUNTS (EMPRUNT,NUMERO,ISBN,EXEMPLAIRE,RENDULE) values (20,3,2038704015,1,sysdate-3);